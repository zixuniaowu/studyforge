import{g as C,u as k,r as l,j as e,R as q,A as z,B as W,T as S,i as h,w as j}from"./index-B2xJFW01.js";import{C as p}from"./circle-check-big-cGskAv4j.js";import{C as $}from"./circle-x-8Hli0WOT.js";const B=()=>{const c=C(),t=k(s=>s.language),[d,f]=l.useState([]),[y,b]=l.useState(!0),[o,N]=l.useState(!1),x=async()=>{b(!0);try{const s=t==="ja"?"ja":"zh-CN",a=await h.wrongAnswers.toArray(),m=o?a:a.filter(r=>!r.mastered),i=(await Promise.all(m.map(async r=>{const g=await h.questions.get(r.questionId),u=await h.exams.get(r.examId);return u&&u.language===s?{...r,question:g,exam:u}:null}))).filter(r=>r!==null&&r.question!==void 0&&r.exam!==void 0).sort((r,g)=>new Date(g.lastWrongAt).getTime()-new Date(r.lastWrongAt).getTime());f(i)}catch(s){console.error("Failed to load wrong answers:",s)}finally{b(!1)}};l.useEffect(()=>{x()},[t,o]);const v=async s=>{await j.markMastered(s),await x()},A=async s=>{const a=t==="ja"?"この記録を削除しますか？":"确定删除此记录？";window.confirm(a)&&(await j.deleteWrongAnswer(s),await x())},w=s=>{c(`/quiz/${s}?mode=practice`)};return y?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(q,{size:40,className:"animate-spin text-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-amber-50/30",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:e.jsx("div",{className:"px-6 lg:px-10 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c("/"),className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(z,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:t==="ja"?"間違いノート":"错题本"}),e.jsxs("p",{className:"text-base text-gray-500",children:[d.length," ",t==="ja"?"問":"题"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:s=>N(s.target.checked),className:"rounded border-gray-300"}),t==="ja"?"習得済みも表示":"显示已掌握"]})})]})})}),e.jsx("div",{className:"px-6 lg:px-10 py-6",children:d.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-slate-100 rounded-full flex items-center justify-center",children:e.jsx(W,{size:40,className:"text-slate-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:t==="ja"?"間違いノートは空です":"错题本是空的"}),e.jsx("p",{className:"text-gray-600 mb-6",children:t==="ja"?`練習問題を解いて間違えた問題がここに記録されます。
まずは練習を始めましょう！`:`做练习题时答错的题目会记录在这里。
先去做一些练习吧！`}),e.jsx("button",{onClick:()=>c("/"),className:"px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors",children:t==="ja"?"練習を始める":"开始练习"})]}):e.jsx("div",{className:"space-y-4 max-w-4xl mx-auto",children:d.map(s=>e.jsxs("div",{className:`bg-white rounded-2xl border ${s.mastered?"border-green-200 bg-green-50/50":"border-gray-200"} p-6 shadow-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.exam?.provider==="AWS"?"bg-amber-100 text-amber-700":s.exam?.provider==="Azure"?"bg-blue-100 text-blue-700":s.exam?.provider==="GCP"?"bg-emerald-100 text-emerald-700":s.exam?.provider==="SAP"?"bg-cyan-100 text-cyan-700":"bg-gray-100 text-gray-700"}`,children:s.exam?.provider}),e.jsx("span",{className:"text-sm text-gray-500",children:s.exam?.code})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:t==="ja"?`${s.wrongCount}回間違い`:`错${s.wrongCount}次`}),s.mastered&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:t==="ja"?"習得済":"已掌握"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-3",children:s.question?.question}),e.jsx("div",{className:"space-y-2",children:s.question?.options&&Object.entries(s.question.options).map(([a,m])=>{const n=Array.isArray(s.correctAnswer)?s.correctAnswer.includes(a):s.correctAnswer===a,i=Array.isArray(s.userAnswer)?s.userAnswer.includes(a):s.userAnswer===a;return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg ${n?"bg-green-50 border border-green-200":i?"bg-red-50 border border-red-200":"bg-gray-50"}`,children:[e.jsx("span",{className:`flex-shrink-0 w-7 h-7 rounded-full flex items-center justify-center text-sm font-medium ${n?"bg-green-500 text-white":i?"bg-red-500 text-white":"bg-gray-200 text-gray-600"}`,children:a}),e.jsx("span",{className:"text-gray-700 flex-1",children:m}),n&&e.jsx(p,{size:20,className:"text-green-500 flex-shrink-0"}),i&&!n&&e.jsx($,{size:20,className:"text-red-500 flex-shrink-0"})]},a)})})]}),s.question?.explanation&&e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:t==="ja"?"解説":"解析"}),e.jsx("p",{className:"text-blue-700",children:s.question.explanation})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>w(s.examId),className:"px-4 py-2 text-sm bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors",children:t==="ja"?"この試験を練習":"练习此考试"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s.mastered&&e.jsxs("button",{onClick:()=>v(s.id),className:"px-4 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors flex items-center gap-1",children:[e.jsx(p,{size:16}),t==="ja"?"習得済み":"标记已掌握"]}),e.jsx("button",{onClick:()=>A(s.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(S,{size:18})})]})]})]},s.id))})})]})};export{B as WrongAnswersPage};
