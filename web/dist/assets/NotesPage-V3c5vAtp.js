import{c as v,a as A,X as g,u as b,j as e,T as L,d as D,r as h,g as M,C as E,B as P}from"./index-C6rNVC4f.js";import{F as _}from"./file-text-B3Tk69Qh.js";import{P as H}from"./plus-dif_SeHE.js";import{S as I}from"./search-DSc2xa3j.js";import{E as F}from"./eye-BJJE3S4r.js";import{X as R}from"./x-CfqPSX6y.js";import{H as B}from"./house-CDyYd-Q8.js";const Q=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],w=v("pen-line",Q);const O=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],V=v("save",O);const X=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],J=v("tag",X),K=A((s,c)=>({notes:[],currentNote:null,isLoading:!1,searchQuery:"",selectedTags:[],loadNotes:async()=>{s({isLoading:!0});try{const t=await g.getAllNotes();s({notes:t,isLoading:!1})}catch(t){console.error("Failed to load notes:",t),s({isLoading:!1})}},createNote:async t=>{const l=new Date().toISOString(),n={...t,id:`note-${Date.now()}`,createdAt:l,updatedAt:l};await g.createNote(n);const i=await g.getAllNotes();return s({notes:i,currentNote:n}),n.id},updateNote:async(t,l)=>{await g.updateNote(t,l);const n=await g.getAllNotes();if(c().currentNote?.id===t){const m=n.find(r=>r.id===t);s({notes:n,currentNote:m||null})}else s({notes:n})},deleteNote:async t=>{await g.deleteNote(t);const l=await g.getAllNotes();c().currentNote?.id===t?s({notes:l,currentNote:null}):s({notes:l})},selectNote:t=>{s({currentNote:t})},setSearchQuery:t=>{s({searchQuery:t})},setSelectedTags:t=>{s({selectedTags:t})},searchNotes:async t=>{s({isLoading:!0,searchQuery:t});try{const l=t?await g.searchNotes(t):await g.getAllNotes();s({notes:l,isLoading:!1})}catch(l){console.error("Failed to search notes:",l),s({isLoading:!1})}}})),U=({note:s,isSelected:c,onSelect:t,onDelete:l})=>{const n=b(a=>a.language),i=a=>new Date(a).toLocaleDateString(n==="ja"?"ja-JP":"zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=(a,x=100)=>{const p=a.replace(/[#*`>\-\[\]]/g,"").trim();return p.length>x?p.slice(0,x)+"...":p},r=a=>{a.stopPropagation(),l()};return e.jsxs("div",{onClick:t,className:`group p-4 rounded-lg border cursor-pointer transition-all ${c?"border-cyan-500 bg-cyan-50 shadow-md":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(_,{size:16,className:c?"text-cyan-600":"text-slate-400"}),e.jsx("h3",{className:`font-medium truncate ${c?"text-cyan-800":"text-slate-800"}`,children:s.title||(n==="ja"?"無題のノート":"无标题笔记")})]}),e.jsx("button",{onClick:r,className:"p-1 opacity-0 group-hover:opacity-100 hover:bg-red-100 rounded transition-all",title:n==="ja"?"削除":"删除",children:e.jsx(L,{size:14,className:"text-red-500"})})]}),e.jsx("p",{className:"text-sm text-slate-500 mb-3 line-clamp-2",children:m(s.content)||(n==="ja"?"内容なし":"暂无内容")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.tags.slice(0,3).map((a,x)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-slate-100 text-slate-500 text-xs rounded",children:a},x)),s.tags.length>3&&e.jsxs("span",{className:"text-xs text-slate-400",children:["+",s.tags.length-3]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-400",children:[e.jsx(D,{size:12}),i(s.updatedAt)]})]})]})},G=({notes:s,currentNote:c,searchQuery:t,onSelectNote:l,onCreateNote:n,onDeleteNote:i,onSearchChange:m})=>{const r=b(a=>a.language);return e.jsxs("div",{className:"flex flex-col h-full bg-white border-r border-slate-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:r==="ja"?"ノート":"笔记"}),e.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(H,{size:16}),r==="ja"?"新規":"新建"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",value:t,onChange:a=>m(a.target.value),placeholder:r==="ja"?"ノートを検索...":"搜索笔记...",className:"w-full pl-9 pr-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-slate-400 text-sm",children:t?r==="ja"?"検索結果がありません":"没有找到匹配的笔记":r==="ja"?"ノートがありません":"暂无笔记"}),!t&&e.jsx("button",{onClick:n,className:"mt-2 text-cyan-600 hover:text-cyan-700 text-sm font-medium",children:r==="ja"?"最初のノートを作成":"创建第一篇笔记"})]}):s.map(a=>e.jsx(U,{note:a,isSelected:c?.id===a.id,onSelect:()=>l(a),onDelete:()=>i(a.id)},a.id))}),e.jsx("div",{className:"p-4 border-t border-slate-200",children:e.jsx("p",{className:"text-xs text-slate-400 text-center",children:r==="ja"?`${s.length} 件のノート`:`共 ${s.length} 篇笔记`})})]})},W=({note:s,onSave:c})=>{const t=b(o=>o.language),[l,n]=h.useState(""),[i,m]=h.useState(""),[r,a]=h.useState([]),[x,p]=h.useState(""),[f,j]=h.useState(!1),[N,u]=h.useState(!1),d=h.useRef(null);h.useEffect(()=>{s?(n(s.title),m(s.content),a(s.tags),u(!1)):(n(""),m(""),a([]),u(!1))},[s?.id]),h.useEffect(()=>(N&&s&&(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{c({title:l,content:i,tags:r}),u(!1)},1e3)),()=>{d.current&&clearTimeout(d.current)}),[l,i,r,N,s,c]);const C=o=>{n(o.target.value),u(!0)},k=o=>{m(o.target.value),u(!0)},S=()=>{x.trim()&&!r.includes(x.trim())&&(a([...r,x.trim()]),p(""),u(!0))},z=o=>{a(r.filter(y=>y!==o)),u(!0)},T=()=>{s&&N&&(c({title:l,content:i,tags:r}),u(!1))},$=o=>o.replace(/^### (.*$)/gm,'<h3 class="text-lg font-semibold mt-4 mb-2">$1</h3>').replace(/^## (.*$)/gm,'<h2 class="text-xl font-bold mt-4 mb-2">$1</h2>').replace(/^# (.*$)/gm,'<h1 class="text-2xl font-bold mt-4 mb-3">$1</h1>').replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="bg-slate-100 px-1 rounded text-sm">$1</code>').replace(/^- (.*$)/gm,'<li class="ml-4">$1</li>').replace(/\n/g,"<br/>");return s?e.jsxs("div",{className:"flex-1 flex flex-col bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>j(!1),className:`px-3 py-1.5 text-sm font-medium rounded transition-colors ${f?"text-slate-600 hover:bg-slate-100":"bg-cyan-100 text-cyan-700"}`,children:[e.jsx(w,{size:14,className:"inline mr-1"}),t==="ja"?"編集":"编辑"]}),e.jsxs("button",{onClick:()=>j(!0),className:`px-3 py-1.5 text-sm font-medium rounded transition-colors ${f?"bg-cyan-100 text-cyan-700":"text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(F,{size:14,className:"inline mr-1"}),t==="ja"?"プレビュー":"预览"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsx("span",{className:"text-xs text-amber-600",children:t==="ja"?"未保存の変更あり":"有未保存的更改"}),e.jsxs("button",{onClick:T,disabled:!N,className:"flex items-center gap-1 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-300 text-white text-sm font-medium rounded transition-colors",children:[e.jsx(V,{size:14}),"保存"]})]})]}),e.jsx("div",{className:"px-6 pt-6",children:e.jsx("input",{type:"text",value:l,onChange:C,placeholder:t==="ja"?"タイトルを入力...":"输入标题...",className:"w-full text-2xl font-bold text-slate-800 placeholder-slate-300 border-none outline-none"})}),e.jsxs("div",{className:"px-6 py-3 flex items-center gap-2 flex-wrap",children:[e.jsx(J,{size:14,className:"text-slate-400"}),r.map((o,y)=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-slate-100 text-slate-600 text-sm rounded group",children:[o,e.jsx("button",{onClick:()=>z(o),className:"text-slate-400 hover:text-red-500",children:e.jsx(R,{size:12})})]},y)),e.jsx("input",{type:"text",value:x,onChange:o=>p(o.target.value),onKeyDown:o=>o.key==="Enter"&&S(),placeholder:t==="ja"?"タグを追加...":"添加标签...",className:"px-2 py-0.5 text-sm border border-dashed border-slate-300 rounded outline-none focus:border-cyan-500"})]}),e.jsx("div",{className:"flex-1 px-6 pb-6 overflow-hidden",children:f?e.jsx("div",{className:"h-full overflow-y-auto prose prose-slate max-w-none",dangerouslySetInnerHTML:{__html:$(i)}}):e.jsx("textarea",{value:i,onChange:k,placeholder:t==="ja"?"Markdown でノートを書く...":"用 Markdown 写笔记...",className:"w-full h-full resize-none text-slate-700 placeholder-slate-300 border-none outline-none font-mono text-sm leading-relaxed"})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{size:48,className:"mx-auto text-slate-300 mb-4"}),e.jsx("p",{className:"text-slate-500",children:t==="ja"?"ノートを選択または作成してください":"选择或创建一篇笔记"})]})})};function le(){const s=M(),c=b(d=>d.language),{notes:t,currentNote:l,searchQuery:n,loadNotes:i,createNote:m,updateNote:r,deleteNote:a,selectNote:x,searchNotes:p}=K();h.useEffect(()=>{i()},[i]);const f=async()=>{await m({pageId:"/notes",title:"",content:"",tags:[]})},j=async d=>{l&&await r(l.id,d)},N=async d=>{confirm(c==="ja"?"このノートを削除しますか？":"确定要删除这篇笔记吗？")&&await a(d)},u=d=>{p(d)};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-slate-50",children:[e.jsx("header",{className:"bg-slate-800 text-white sticky top-0 z-50",children:e.jsx("div",{className:"px-6 lg:px-10 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>s("/"),className:"flex items-center gap-2 text-slate-300 hover:text-white transition-colors",children:[e.jsx(B,{size:20}),e.jsx("span",{className:"hidden sm:inline",children:c==="ja"?"ホーム":"首页"})]}),e.jsx(E,{size:16,className:"text-slate-500"}),e.jsx("h1",{className:"text-lg font-semibold",children:c==="ja"?"学習ノート":"学习笔记"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:20,className:"text-slate-400"}),e.jsx("span",{className:"font-semibold",children:"StudyForge"})]})]})})}),e.jsxs("main",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-80 flex-shrink-0",children:e.jsx(G,{notes:t,currentNote:l,searchQuery:n,onSelectNote:x,onCreateNote:f,onDeleteNote:N,onSearchChange:u})}),e.jsx(W,{note:l,onSave:j})]}),e.jsx("footer",{className:"bg-slate-800 text-white py-3",children:e.jsx("div",{className:"px-6 lg:px-10 text-center",children:e.jsxs("p",{className:"text-slate-300 text-sm",children:[e.jsx("span",{className:"font-semibold text-white",children:"StudyForge"}),e.jsx("span",{className:"mx-2",children:"·"}),c==="ja"?"AI学習プラットフォーム":"AI 学习平台"]})})})]})}export{le as default};
